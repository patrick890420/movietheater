<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.theater.mapper.EventMapper">

<sql id="criteria">
  <trim prefix="(" suffix=") AND" prefixOverrides="OR">
    <foreach item="type" collection="typeArr">
            <!-- Criteria->이름 같으면 getTypeArr(자동 호출) 실행 -->
      <trim prefix="OR">
        <choose>
          <when test="type== 'T'.toString()">
            title like '%'||#{keyword}||'%'
          </when>
          <when test="type== 'C'.toString()">
            content like '%'||#{keyword}||'%'
          </when>
        </choose>
      </trim>
    </foreach>
  </trim>
</sql>


<!-- Common -->
<insert id="eventInsert">
  <selectKey keyProperty="event_cd" order="BEFORE" resultType="int">
    select event_seq.nextval from dual
  </selectKey>
  insert into event (event_cd,title,content,kind,hits)
  values (#{event_cd},#{title},#{content},'0',0)
</insert>

<select id="getAdminBoardView" resultType="com.theater.domain.EventVO">
select * from event where event_cd= #{event_cd} 
</select>


<!-- admin -->
<select id="getEventList" resultType="com.theater.domain.EventVO">
  <![CDATA[
        SELECT *
        FROM ( SELECT ROWNUM RN,
                A.*
              FROM (SELECT * FROM EVENT
                    WHERE
        ]]> 
                    <if test="searchType == 'title'">TITLE LIKE '%'||#{searchName}||'%'</if>
                    <if test="searchType == 'content'">CONTENT LIKE '%'||#{searchName}||'%'</if>
                    <if test="searchType == null or searchType == ''"> 1=1</if>
        <![CDATA[
                    ORDER BY EVENT_CD DESC) A)
        WHERE RN > (#{pageNum}-1) * #{amount} AND RN <= #{pageNum} * #{amount}
        ]]>
<!--     <![CDATA[ -->
<!--       select * from event where event_cd > 0 order by event_cd desc -->
<!--     ]]> -->
</select>

<select id="getAdminEventList" resultType="com.theater.domain.EventVO">
 Select * from EVENT
</select>

<update id="modify">
  update event set title= #{title}, content= #{content}
  where event_cd= #{event_cd}
</update>

<delete id="EventDelete">
  delete event where event_cd= #{event_cd}
</delete>


<!-- User -->
<!-- 조회수 -->
<update id="getViewCount">
  update event set hits= hits+ 1 where event_cd= #{event_cd}
</update>

<!-- 전체 래코드 갯수 -->
<select id="getTotal" resultType="int">
  SELECT COUNT(*) AS TOTAL FROM EVENT
  WHERE  <if test="searchType == 'title'">TITLE LIKE '%'||#{searchName}||'%'</if>
         <if test="searchType == 'content'">CONTENT LIKE '%'||#{searchName}||'%'</if>
         <if test="searchType == null or searchType == ''"> 1=1</if>
</select>

<select id="nextPage" resultType="com.theater.domain.EventVO">
  <![CDATA[
    select * from event where event_cd< #{event_cd} and rownum=1 order by event_cd desc
    ]]>
</select>

<select id="prevPage" resultType="com.theater.domain.EventVO">
  <![CDATA[
    select * from event where event_cd> #{event_cd} and rownum=1 order by event_cd asc
    ]]>
</select>

<select id="getEventIndex" resultType="com.theater.domain.EventVO"> 
  SELECT * FROM  event order by event_cd desc
 </select>

</mapper>

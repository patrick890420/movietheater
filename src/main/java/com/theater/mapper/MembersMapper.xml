<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.theater.mapper.MembersMapper">

<!-- 회원가입 -->
<insert id="MemberInsert">
  insert all
    into members (userid,userpw,username,birth,gender,phone,email) 
        values (#{userid}, #{userpw}, #{username}, #{birth}, #{gender}, #{phone}, #{email})
    into member_auth (userid,auth) values (#{userid},'ROLE_USER')
  select*from dual
</insert>


<select id="idChk" resultType="int">
	SELECT COUNT(*) FROM MEMBERS
	WHERE userid = #{userid}
</select>

<select id="selectMember" resultType="com.theater.domain.MemberVO">
  select * from members where userid = #{userid}
  </select>
  
<update id="memberUpdate" parameterType="com.theater.domain.MemberVO">
   update members set 
   username = #{username},
   phone = #{phone},
   email = #{email}
   where userid = #{userid} 
</update>

<select id="pwChk" resultType="String">
    select count(*) from members <!--전체 비번 중복인걸 확인하는거라면 count 빼야 하는 것 아닌가...! 모르겠군 ㅋ int가 맞는지..?-->
    where userpw= #{userpw}
</select>

<select id="selectPw" resultType="String">
  select userpw from members where userid = #{userid}
  </select>
  
<update id="mypasspro">
update members set
userpw = #{userpw}
where userid = #{userid}
</update>

<select id="getRelist" resultType="com.theater.domain.ReListVO">
SELECT m.title, m.subtitle, m.poster, t.tkt_nums as tkt_nums, s.seat_cd as seat_cd,t.tkt_date as tkt_date
,m.m_cd as mm_cd, t.m_cd as tm_cd, t.tkt_cd as ttkt_cd, s.tkt_cd as stkt_cd,t.id as id,t.tkt_time as tkt_time

FROM movies m, ticketings t, sold_seats s

WHERE m.m_cd = t.m_cd
AND t.tkt_cd = s.tkt_cd
AND t.id = #{id}
ORDER BY t.tkt_cd desc
</select>

<select id="memberSelect" resultType="com.theater.domain.MemberVO"> <!-- 위에 멤버 조회 있는데 굳이..? 만들어야 할가,,? 타입이,, 달라서,,?-->
select * from members
</select>

 <delete id="adminDelete">
  delete from members where userid=#{userid}
 </delete>
 
 <delete id="byebyespro">
 delete from members 
 where userid= #{userid}

 
 
 </delete>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.theater.mapper.NoticeMapper">
  <sql id ="criteria">
    <trim prefix="(" suffix=") AND" prefixOverrides="OR">
      <foreach item ='type' collection="typeArr">
        <trim prefix="OR">  
          <choose>
            <when test="type == 'title'.toString()">
              TITLE LIKE '%'||#{keyword}||'%'
            </when>
            <when test="type == 'content'.toString()">
              CONTENT LIKE '%'||#{keyword}||'%'
            </when>
          </choose>
        </trim>
      </foreach>
    </trim>
  </sql>  
  
  <select id="getList" resultType="com.theater.domain.NoticeVO">
    <![CDATA[
      SELECT 
        NT_CD, TITLE, CONTENT,E_IMG ,TO_CHAR(WDATE, 'YYYY-MM-DD') AS WDATE  , HITS 
      FROM(SELECT/*+ INDEX_DESC(SYS_C008533)*/ 
          ROWNUM RN, NT_CD, TITLE, CONTENT, E_IMG, WDATE, HITS 
         FROM NOTICE WHERE 
    ]]>
    
<!--     <include refid="criteria"></include> -->
    
    <![CDATA[       
      ROWNUM <=(#{pageNum} * #{amount})
        )WHERE RN > (#{pageNum}-1) * #{amount}
    ]]>  
  </select>
  
  <select id="getTotalCount" resultType="int">
    <![CDATA[  
      SELECT COUNT(*) AS TOTALCOUNT FROM NOTICE WHERE
    ]]>
      <include refid="criteria"></include>
    <![CDATA[  
 
    ]]>
  </select>

</mapper>

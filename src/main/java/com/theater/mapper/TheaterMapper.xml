<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.theater.mapper.TheaterMapper">

<select id="theaterList" resultType="com.theater.domain.TheatersVO"> <!-- 기본극장 리스트 -->
  SELECT * FROM THEATERS where t_area= #{t_area}
</select>
<select id="theaterinfo" resultType="com.theater.domain.TheatersVO"> <!-- 기본극장 정보 -->
  SELECT * FROM THEATERS where t_name= #{t_name}
</select>
<select id="totaltheaterList" resultType="com.theater.domain.TheatersVO"> <!-- 기본극장 리스트 -->
  SELECT * FROM THEATERS
</select>
<select id="theaterlist" resultType="com.theater.domain.TheatersVO"> <!-- admin 극장 리스트 -->
  SELECT * FROM THEATERS
</select>
<select id="adminScreenInfo" resultType="com.theater.domain.ScreensVO"> <!-- admin 극장 리스트 -->
  SELECT * FROM SCREENS where t_cd= #{t_cd}
</select>
<select id="theatercode" resultType="int"> <!-- 극장코드 -->
  select max(t_cd) from theaters
</select>
<select id="screencode" resultType="int"> <!-- 극장코드 -->
  select max(screen_cd) from screens
</select>
<select id="areainfo" resultType="com.theater.domain.AreainfoVO"> <!-- area코드 >> 이름 -->
  SELECT * FROM AREAINFO
</select>

<!-- 영화 insert -->
  <insert id="theaterInsertPro">
  <selectKey keyProperty="t_cd" order="BEFORE" resultType="int">
        select t_cd_seq.nextval from dual
      </selectKey>
    insert into theaters (t_cd, t_area, t_name, t_address, t_screen, t_seat) values (#{t_cd}, #{t_area}, #{t_name}, #{t_address}, #{t_screen},#{t_seat})
  </insert>
<!-- 영화 insert2 -->
  <insert id="theaterInsertPro2">
  <selectKey keyProperty="screen_cd" order="BEFORE" resultType="int">
        select screen_cd_seq.nextval from dual
      </selectKey>
    insert into screens (screen_cd, t_cd, screen_type, screen_name, seat_amount) values (#{screen_cd}, #{t_cd}, #{screen_type}, #{screen_name}, #{seat_amount})
  </insert>  
<!-- 영화 insert3 -->
  <insert id="theaterInsertPro3" parameterType="java.util.List">
      
      <selectKey keyProperty="seat_cd" order="BEFORE"  resultType="int">
        select seat_cd_seq.nextval from dual 
      </selectKey>

    <foreach collection="list" item="list" open="insert all" close="SELECT * FROM SYS.DUAL" separator=" ">
      into seats 
        (seat_cd, screen_cd, seat_name) 
      values
        (#{seat_cd}, #{screen_cd}, #{list})
    </foreach>
  </insert>    
  
  <select id="adminScheduleSelect" resultType="com.theater.domain.ScheduleVO">
    SELECT * FROM MOVIES m, films f
      WHERE m.m_cd = f.m_cd
        and f.film_status = 1
  </select>
  
  <select id="getCityCheck" resultType="com.theater.domain.TheatersVO">
    SELECT
     T_NAME,T_CD
    FROM THEATERS
    WHERE T_AREA = #{t_area}
  </select>
  <select id="getCityCheck2" resultType="com.theater.domain.TheatersVO">
    SELECT
    T_NAME,T_CD,T_ADDRESS,T_SCREEN,T_SEAT
    FROM Theaters
    WHERE T_NAME = #{t_name}
  </select>

  <select id="getScreenInfo" resultType="com.theater.domain.TheatersVO"><!-- vo 수정필요 -->
    SELECT
    (T.T_SEAT/T.T_SCREEN) AS T_SEAT, TO_CHAR(ft.start_time,'HH24:MI') AS START_TIME, T_NAME, T_ADDRESS, T_SCREEN, M.TITLE AS TITLE
    FROM FILMS f ,FILM_TIMETABLE ft,THEATERS t, SCREENS s, MOVIES m
    WHERE t.T_CD =s.T_CD  
    AND s.SCREEN_CD = f.SCREEN_CD 
    AND f.FILM_CD = ft.FILM_CD
    AND t.T_NAME =#{t_name}
    AND TO_CHAR(ft.START_TIME,'yyyy-MM-dd') = #{start_time}
    AND f.M_CD = m.M_CD
</select>  
</mapper>

